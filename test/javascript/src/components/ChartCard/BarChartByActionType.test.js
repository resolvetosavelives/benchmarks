import fs from "fs"
import React from "react"
import { render as renderForConnect } from "../../../test-utils-for-react"
import BarChartByActionType from "components/ChartCard/BarChartByActionType"
import { countActionsByActionType } from "config/selectors"

const strTechnicalAreas = fs.readFileSync(
  `${__dirname}/../../../../fixtures/files/all_benchmark_technical_areas.json`,
  "utf-8"
)
const strActions = fs.readFileSync(
  `${__dirname}/../../../../fixtures/files/all_benchmark_indicator_actions.json`,
  "utf-8"
)

jest.mock("config/selectors", () => ({
  countActionsByActionType: jest.fn(),
}))

it("BarChartByActionType has the expected 2 divs", () => {
  countActionsByActionType.mockReturnValue([])
  const renderedComponent = renderForConnect(
    <BarChartByActionType width="100%" height="240" />,
    {
      initialState: {
        technicalAreas: JSON.parse(strTechnicalAreas),
        planChartLabels: [
          [
            "Legislation",
            "IHR coordination",
            "AMR",
            "Zoonotic disease",
            "Food safety",
            "Immunization",
            "Laboratory",
            "Biosafety \u0026 biosecurity",
            "Surveillance",
            "Human resources",
            "Preparedness",
            "Rapid response",
            "Linking public health",
            "Medical countermeasures",
            "Risk communication",
            "Points of entry",
            "Chemical events",
            "Radiation",
          ],
          [
            "Advocacy",
            "Assessment and Data Use",
            "Coordination",
            "Designation",
            "Dissemination",
            "Financing",
            "Monitoring and Evaluation",
            "Planning and Strategy",
            "Procurement",
            "Program Implementation",
            "SimEx and AAR",
            "SOPs",
            "Surveillance",
            "Tool Development",
            "Training",
          ],
        ],
        // this taken from Nigeria JEE 1-yr
        planActionIds: [
          661,
          785,
          585,
          393,
          682,
          370,
          188,
          324,
          699,
          1,
          807,
          563,
          827,
          733,
          828,
          700,
          662,
          683,
          586,
          2,
          564,
          734,
          394,
          371,
          325,
          786,
          808,
          189,
          565,
          663,
          3,
          190,
          829,
          809,
          787,
          326,
          372,
          735,
          587,
          701,
          684,
          588,
          566,
          702,
          685,
          327,
          788,
          736,
          664,
          810,
          4,
          191,
          830,
          373,
          374,
          665,
          192,
          589,
          5,
          831,
          567,
          703,
          811,
          789,
          737,
          328,
          812,
          790,
          329,
          832,
          738,
          6,
          704,
          568,
          666,
          833,
          705,
          330,
          667,
          791,
          792,
          834,
          706,
          793,
          835,
          707,
          708,
          794,
          709,
          710,
          238,
          107,
          348,
          72,
          442,
          739,
          128,
          482,
          56,
          836,
          725,
          219,
          628,
          148,
          176,
          361,
          73,
          349,
          129,
          149,
          483,
          362,
          57,
          239,
          740,
          443,
          741,
          837,
          726,
          629,
          108,
          220,
          177,
          838,
          350,
          484,
          150,
          363,
          130,
          630,
          178,
          727,
          240,
          58,
          221,
          74,
          742,
          444,
          109,
          131,
          110,
          179,
          364,
          743,
          445,
          59,
          151,
          839,
          241,
          485,
          222,
          631,
          132,
          60,
          111,
          152,
          223,
          446,
          486,
          632,
          744,
          840,
          487,
          133,
          153,
          745,
          224,
          633,
          112,
          634,
          113,
          225,
          635,
          636,
          637,
          652,
          468,
          762,
          869,
          61,
          265,
          426,
          317,
          780,
          507,
          781,
          266,
          870,
          62,
          653,
          508,
          469,
          427,
          763,
          318,
          267,
          764,
          470,
          509,
          319,
          782,
          63,
          654,
          871,
          428,
          655,
          510,
          471,
          429,
          765,
          320,
          268,
          64,
          872,
          321,
          269,
          656,
          511,
          472,
          430,
          270,
          556,
          294,
          295,
          557,
          558,
          296,
          559,
          297,
          560,
          298,
          299,
          561,
          300,
          562,
        ],
        allActions: JSON.parse(strActions),
        dispatch: () => {},
      },
    }
  )
  const container = renderedComponent.container
  const elComponentContainer = container.querySelectorAll(
    ".chart-container.ct-chart-bar"
  )
  const elChartContainer = container.querySelectorAll(".ct-chart") // react-chartist generates this one

  expect(elComponentContainer.length).toEqual(1)
  expect(elChartContainer.length).toEqual(1)
})
